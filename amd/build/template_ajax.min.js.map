{"version":3,"sources":["../src/template_ajax.js"],"names":["define","$","Ajax","Notification","$pageWrapper","templateField","input","find","loadAjax","firstRun","selectedTemplateId","val","languageId","prop","empty","self","promises","call","methodname","args","done","data","addData","parseInt","fail","exception","append","Option","M","str","mod_diplomasafe","select_default_option_template","templates","length","i","template","name","id","getHidden","$hiddenField","on","selectedTemplate"],"mappings":"AAMAA,OAAM,iCAAC,CACH,QADG,CAEH,WAFG,CAGH,mBAHG,CAAD,CAIH,SACCC,CADD,CAECC,CAFD,CAGCC,CAHD,CAID,CACE,MAAO,CACH,KAAS,eAAW,IAkEZC,CAAAA,CAAY,CAAGH,CAAC,CAAC,2BAAD,CAlEJ,CAmEZI,CAAa,CAAG,GA/DpB,UAAuBD,CAAvB,CAAqC,CACjC,KAAKA,YAAL,CAAoBA,CAApB,CACA,KAAKE,KAAL,CAAa,KAAKF,YAAL,CAAkBG,IAAlB,CAAuB,qBAAvB,CAAb,CAIA,KAAKC,QAAL,CAAgB,SAASC,CAAT,CAAmB,IAC3BC,CAAAA,CAAkB,CAAGN,CAAY,CAACG,IAAb,CAAkB,wBAAlB,EAA0CI,GAA1C,EADM,CAE3BC,CAAU,CAAGR,CAAY,CAACG,IAAb,CAAkB,iCAAlB,EAAqDI,GAArD,EAFc,CAG/B,GAAI,CAACC,CAAL,CAAiB,CACb,KAAKN,KAAL,CAAWO,IAAX,CAAgB,UAAhB,KACA,KAAKC,KAAL,GACA,MACH,CACD,KAAKR,KAAL,CAAWO,IAAX,CAAgB,UAAhB,KACA,KAAKP,KAAL,CAAWK,GAAX,CAAe,EAAf,EAT+B,GAU3BI,CAAAA,CAAI,CAAG,IAVoB,CAW3BC,CAAQ,CAAGd,CAAI,CAACe,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAE,+BADU,CAEtBC,IAAI,CAAE,CACF,YAAeP,CADb,CAFgB,CAAD,CAAV,CAXgB,CAiB/BI,CAAQ,CAAC,CAAD,CAAR,CAAYI,IAAZ,CAAiB,SAASC,CAAT,CAAe,CAC5BN,CAAI,CAACD,KAAL,GACAC,CAAI,CAACO,OAAL,CAAaD,CAAb,EACA,GAAIZ,CAAQ,EAAqC,CAAjC,GAAAc,QAAQ,CAACb,CAAD,CAAxB,CAAoD,CAChDK,CAAI,CAACT,KAAL,CAAWK,GAAX,CAAeD,CAAf,CACH,CACJ,CAND,EAMGc,IANH,CAMQrB,CAAY,CAACsB,SANrB,CAOH,CAxBD,CA4BA,KAAKX,KAAL,CAAa,UAAW,CACpB,KAAKR,KAAL,CAAWQ,KAAX,GACA,KAAKR,KAAL,CAAWoB,MAAX,CACI,GAAIC,CAAAA,MAAJ,CAAWC,CAAC,CAACC,GAAF,CAAMC,eAAN,CAAsBC,8BAAjC,CAAiE,EAAjE,CADJ,CAGH,CALD,CASA,KAAKT,OAAL,CAAe,SAASD,CAAT,CAAe,CAC1B,GAA8B,CAA1B,GAAAA,CAAI,CAACW,SAAL,CAAeC,MAAnB,CAAiC,CAC7B,MACH,CACD,IAAK,GAAIC,CAAAA,CAAT,GAAcb,CAAAA,CAAI,CAACW,SAAnB,CAA8B,CAC1B,GAAiC,WAA7B,QAAOX,CAAAA,CAAI,CAACW,SAAL,CAAeE,CAAf,CAAX,CAA8C,CAC1C,QACH,CACD,GAAIC,CAAAA,CAAQ,CAAGd,CAAI,CAACW,SAAL,CAAeE,CAAf,CAAf,CACA,KAAK5B,KAAL,CAAWoB,MAAX,CAAkB,GAAIC,CAAAA,MAAJ,CAAWQ,CAAQ,CAACC,IAApB,CAA0BD,CAAQ,CAACE,EAAnC,CAAlB,CACH,CACJ,CAXD,CAeA,KAAKC,SAAL,CAAiB,UAAW,CACxB,MAAO,MAAKlC,YAAL,CAAkBG,IAAlB,CAAuB,wBAAvB,CACV,CACJ,CAEmB,CAAkBH,CAAlB,CAnEJ,CAoEZmC,CAAY,CAAGlC,CAAa,CAACiC,SAAd,EApEH,CAqEhBjC,CAAa,CAACG,QAAd,KACAJ,CAAY,CAACG,IAAb,CAAkB,iBAAlB,EAAqCiC,EAArC,CAAwC,QAAxC,CAAkD,UAAW,CACzDD,CAAY,CAAC5B,GAAb,CAAiB,EAAjB,EACAN,CAAa,CAACG,QAAd,IACH,CAHD,EAIAJ,CAAY,CAACG,IAAb,CAAkB,qBAAlB,EAAyCiC,EAAzC,CAA4C,QAA5C,CAAsD,UAAW,CAC7DD,CAAY,CAAC5B,GAAb,CAAiB,EAAjB,EACA,GAAI8B,CAAAA,CAAgB,CAAGxC,CAAC,CAAC,IAAD,CAAxB,CACA,GAAIwC,CAAJ,CAAsB,CAClBF,CAAY,CAAC5B,GAAb,CAAiB8B,CAAgB,CAAC9B,GAAjB,EAAjB,CACH,CACJ,CAND,CAOH,CAlFE,CAoFV,CA7FK,CAAN","sourcesContent":["/**\r\n * @developer   Johnny Drud\r\n * @date        07-01-2021\r\n * @company     https://diplomasafe.com\r\n * @copyright   2021 Diplomasafe ApS\r\n */\r\ndefine([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/notification',\r\n], function(\r\n    $,\r\n    Ajax,\r\n    Notification\r\n) {\r\n    return {\r\n        'init' : function() {\r\n            /**\r\n             * @param $pageWrapper\r\n             */\r\n            function TemplateField($pageWrapper) {\r\n                this.$pageWrapper = $pageWrapper;\r\n                this.input = this.$pageWrapper.find('#template_id_select');\r\n                /**\r\n                 * @return void\r\n                 */\r\n                this.loadAjax = function(firstRun) {\r\n                    var selectedTemplateId = $pageWrapper.find('[name=\"template_id\"]').val();\r\n                    var languageId = $pageWrapper.find('#id_language_id option:selected').val();\r\n                    if (!languageId) {\r\n                        this.input.prop('disabled', true);\r\n                        this.empty();\r\n                        return;\r\n                    }\r\n                    this.input.prop('disabled', false);\r\n                    this.input.val('');\r\n                    var self = this;\r\n                    var promises = Ajax.call([{\r\n                        methodname: 'mod_diplomasafe_get_templates',\r\n                        args: {\r\n                            'language_id': languageId\r\n                        }\r\n                    }]);\r\n                    promises[0].done(function(data) {\r\n                        self.empty();\r\n                        self.addData(data);\r\n                        if (firstRun && parseInt(selectedTemplateId) !== 0) {\r\n                            self.input.val(selectedTemplateId);\r\n                        }\r\n                    }).fail(Notification.exception);\r\n                };\r\n                /**\r\n                 * @return void\r\n                 */\r\n                this.empty = function() {\r\n                    this.input.empty();\r\n                    this.input.append(\r\n                        new Option(M.str.mod_diplomasafe.select_default_option_template, '')\r\n                    );\r\n                };\r\n                /**\r\n                 * @return void\r\n                 */\r\n                this.addData = function(data) {\r\n                    if (data.templates.length === 0) {\r\n                        return;\r\n                    }\r\n                    for (var i in data.templates) {\r\n                        if (typeof data.templates[i] === 'undefined') {\r\n                            continue;\r\n                        }\r\n                        var template = data.templates[i];\r\n                        this.input.append(new Option(template.name, template.id));\r\n                    }\r\n                };\r\n                /**\r\n                 * @returns {*}\r\n                 */\r\n                this.getHidden = function() {\r\n                    return this.$pageWrapper.find('[name=\"template_id\"]');\r\n                };\r\n            }\r\n            var $pageWrapper = $('#page-mod-diplomasafe-mod');\r\n            var templateField = new TemplateField($pageWrapper);\r\n            var $hiddenField = templateField.getHidden();\r\n            templateField.loadAjax(true);\r\n            $pageWrapper.find('#id_language_id').on('change', function() {\r\n                $hiddenField.val('');\r\n                templateField.loadAjax(false);\r\n            });\r\n            $pageWrapper.find('#template_id_select').on('change', function() {\r\n                $hiddenField.val('');\r\n                var selectedTemplate = $(this);\r\n                if (selectedTemplate) {\r\n                    $hiddenField.val(selectedTemplate.val());\r\n                }\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"file":"template_ajax.min.js"}